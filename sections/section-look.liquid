<!-- /sections/look.liquid -->

{%- liquid
  assign section_width = section.settings.width
  assign image = section.settings.image
  assign enable_aspect_ratio = section.settings.enable_aspect_ratio
  assign image_aspect_ratio = section.settings.image_aspect_ratio
  assign bg_position = section.settings.bg_position
  assign show_dots = section.settings.show_dots
  assign heading = section.settings.title
  assign text = section.settings.text
  assign text_alignment = section.settings.text_alignment
  assign hotspot_color = section.settings.hotspot_color
  assign text_color = section.settings.text_color
  assign bg_color = section.settings.bg_color
  assign onboarding_price =  10000 | money

  assign animations_enabled = settings.animations_enabled
  assign animation_anchor = '#Look--' | append: section.id
-%}

{%- style -%}
  #Look--{{ section.id }} {
    --PT: {{ section.settings.padding_top }}px;
    --PB: {{ section.settings.padding_bottom }}px;
  }
  {%- if bg_color != 'rgba(0,0,0,0)' and bg_color != '' -%}
    .look[data-section-id="{{ section.id }}"] {
      --bg: {{ bg_color }};
      background: var(--bg);
    }
  {%- endif -%}

  {%- if text_color != 'rgba(0,0,0,0)' and text_color != '' -%}
    #Look--{{ section.id }} { --text: {{ text_color }}; }
    #Look--{{ section.id }} .look__heading { color: var(--text); }
  {%- endif -%}

  {%- if hotspot_color != 'rgba(0,0,0,0)' and hotspot_color != '' -%}
    #Look--{{ section.id }} { --hotspot: {{ hotspot_color }}; }
  {%- endif -%}

  {%- if enable_aspect_ratio -%}
    #Look--{{ section.id }} { --aspect-ratio: {{ image_aspect_ratio | times: 100 | append: '%' }}; }
  {%- else -%}
    {%- unless image == blank -%}
      #Look--{{ section.id }} { --aspect-ratio: {{ 1 | divided_by: image.aspect_ratio | times: 100 | append: '%' }}; }
    {%- else -%}
      #Look--{{ section.id }} { --aspect-ratio: 100%; }
    {%- endunless -%}
  {%- endif -%}

{%- endstyle -%}

<section id="Look--{{ section.id }}"
  data-section-id="{{ section.id }}"
  data-section-type="look"
  class="look section-padding">
  <div class="{{ section_width }}">
    <div class="look__wrapper">
      {%- if section.blocks.size > 0 -%}
        {%- for block in section.blocks -%}
          {%- capture look_products -%}
            {{ look_products }}
            {%- liquid
              assign product = all_products[block.settings.product]
              assign position_x = block.settings.position_x
              assign position_y = block.settings.position_y
            -%}

            <div class="look__slide look__slide--{{ block.id }}"
              data-slide-item="{{ block.id }}"
              {{ block.shopify_attributes }}>
              {%- if product != blank -%}
                {%- render 'product-grid-item',
                  product: product,
                  index: forloop.index,
                  tabindex_hidden: true,
                  image_animation: 'fade-up',
                  text_animation: 'fade-up',
                  animation_anchor: animation_anchor %}
              {%- else -%}
                {%- assign placeholder = 'product-' | append: forloop.index -%}
                {%- render 'product-grid-item--onboarding',
                  title: 'Product Title',
                  placeholder: placeholder,
                  index: forloop.index,
                  animation_delay: forloop.index0,
                  tabindex_hidden: true,
                  image_animation: 'fade-up',
                  text_animation: 'fade-up',
                  animation_anchor: animation_anchor -%}
              {%- endif -%}
            </div>
          {%- endcapture -%}

          {%- if show_dots -%}
            {%- capture look_dot -%}
              {{ look_dot }}
              <button class="pointer"
                aria-label="{{ 'general.accessibility.product' | t | append: '-' | append: forloop.index }}"
                data-top="{{ position_y }}"
                data-left="{{ position_x }}"
                data-pointer="{{ forloop.index0 }}"
                {% if animations_enabled %}
                  data-aos="fade"
                  data-aos-duration="500"
                  data-aos-anchor="{{ animation_anchor }}"
                {% endif %}
                style="top: {{ position_y }}%; left: {{ position_x }}%;">
                <span class="pointer__inner"></span>
              </button>
            {%- endcapture -%}
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}

      <div class="look__column look__column--image"
        {% if animations_enabled %}
          data-aos="fade"
          data-aos-duration="500"
          data-aos-anchor="{{ animation_anchor }}"
        {% endif %}>

        {%- unless image == blank -%}
          <div class="look__image {{ bg_position | prepend: 'bg-pos-' }} lazyload"
            data-bgset="{% render 'bgset', image: image %}"
            data-parent-fit="cover"
            data-sizes="auto">
          </div>

          <noscript>
            <div class="look__image no-js-image" style="background-image: url({{ image | img_url: '2048x' }});"></div>
          </noscript>
        {%- else -%}
          <div class="look__image look__image--placeholder placeholder-svg--overlayed">
            {{- 'collection-1' | placeholder_svg_tag: 'placeholder-svg-filled' -}}
          </div>
        {%- endunless -%}

        <div class="look__column__pointers">
          {{ look_dot }}
        </div>
      </div>

      {%- if look_products -%}
        <button type="button" class="look__column__button btn btn--primary" aria-controls="look__column__button--{{ section.id }}" data-drawer-toggle>
          {{- 'general.accessibility.show_products' | t -}}
        </button>
      {%- endif -%}

      <div class="look__column look__column--slider {{ text_alignment }}">
        <div class="look__content">
          {%- unless heading == blank and text == blank -%}
            <div class="look__text">
              {%- if heading != blank -%}
                <h3 class="look__heading h2"
                  {% if animations_enabled %}
                    data-aos="come-up"
                    data-aos-duration="400"
                    data-aos-anchor="{{ animation_anchor }}"
                  {% endif %}>{{ heading }}</h3>

                {%- if settings.show_spacer_lines -%}
                  <hr
                  {% if animations_enabled %}
                    data-aos="fade-up"
                    data-aos-duration="400"
                    data-aos-anchor="{{ animation_anchor }}"
                  {% endif %}>
                {%- endif -%}
              {%- endif -%}

              {%- if text != blank -%}
                <div class="rich-text__text"
                  {% if animations_enabled %}
                    data-aos="fade-up"
                    data-aos-duration="400"
                    data-aos-anchor="{{ animation_anchor }}"
                  {% endif %}>
                  {{- text -}}
                </div>
              {%- endif -%}
            </div>
          {%- endunless -%}

          {%- if look_products -%}
            <div class="look__column__drawer drawer drawer--bottom" id="look__column__button--{{ section.id }}" aria-hidden="true" role="dialog" data-drawer>
              <button type="button" class="drawer__close-button" aria-controls="look__column__button--{{ section.id }}" data-drawer-toggle>
                <span class="visually-hidden">{{ 'general.accessibility.close_drawer' | t }}</span>
                {%- render 'icon-close-small' -%}
              </button>

              <div class="look__column__drawer__inner" data-scroll>
                <div class="look__column__drawer__products">
                  <div class="look__slider" data-slider
                    {% if animations_enabled %}
                      data-aos="fade-up"
                      data-aos-duration="800"
                      data-aos-anchor="{{ animation_anchor }}"
                    {% endif %}>
                    {{ look_products }}
                  </div>
                </div>
                <button type="button" class="drawer__secondary-close-button btn btn--primary" aria-controls="look__column__button--{{ section.id }}" data-drawer-toggle>
                  {{- 'general.accessibility.close_drawer' | t -}}
                </button>
              </div>
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Shop the look",
  "class": "section-look",
  "max_blocks": 4,
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "id": "enable_aspect_ratio",
      "type": "checkbox",
      "label": "Set custom aspect ratio",
      "default": true
    },
    {
      "type": "range",
      "id": "image_aspect_ratio",
      "label": "Aspect ratio",
      "min": 0.5,
      "max": 1.5,
      "step": 0.1,
      "unit": ":1",
      "default": 1.0
    },
    {
      "type": "select",
      "id": "bg_position",
      "label": "Position",
      "default": "center-center",
      "options": [
        { "label": "Top", "value": "center-top" },
        { "label": "Right", "value": "right-center" },
        { "label": "Center", "value": "center-center" },
        { "label": "Left", "value": "left-center" },
        { "label": "Bottom", "value": "center-bottom" }
      ]
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Shop the Look"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text",
      "default": "<p>Our most popular looks of the season</p>"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "default": "text-left",
      "options": [
        { "label": "Center", "value": "text-center" },
        { "label": "Left", "value": "text-left" }
      ]
    },
    {
      "id": "show_dots",
      "type": "checkbox",
      "label": "Show hotspots",
      "default": true
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "hotspot_color",
      "label": "Hotspot color"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background"
    },
    {
      "type": "header",
      "content": "Section spacing"
    },
    {
      "type": "select",
      "id": "width",
      "label": "Width",
      "default": "wrapper--full-padded",
      "options": [
        { "value": "wrapper--full-padded", "label": "Full width padded" },
        { "value": "wrapper", "label": "Page width" }
      ]
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding bottom",
      "default": 60
    }
  ],
  "blocks": [
    {
      "name": "Product",
      "type": "product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "header",
          "content": "Dot position"
        },
        {
          "type":    "range",
          "id":      "position_x",
          "min":     10,
          "max":     90,
          "step":    1,
          "label":   "Horizontal",
          "unit":    "%",
          "default": 50
        },
        {
          "type":    "range",
          "id":      "position_y",
          "min":     10,
          "max":     90,
          "step":    1,
          "label":   "Vertical",
          "unit":    "%",
          "default": 50
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Shop the look ",
      "category": "Image",
      "blocks": [
        {
          "type": "product",
          "settings": {
            "position_x": 31,
            "position_y": 41
          }
        },
        {
          "type": "product",
          "settings": {
            "position_x": 50,
            "position_y": 63
          }
        },
        {
          "type": "product",
          "settings": {
            "position_x": 73,
            "position_y": 47
          }
        }
      ]
    }
  ]
}
{% endschema %}
